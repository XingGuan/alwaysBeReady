### 视觉格式化模型（`Visual Formatting Model`）
+ 这是一个更底层的概念，它描述了盒子模型、定位、浮动、文档流等如何协同工作，最终将`CSS`和`DOM`树转换成屏幕上可见的页面。   

> 为什么重要：深入理解这个，很多布局上的"怪异行为"都会变得有章可循，不再是凭经验试，而是能预测结果。   

### 什么是视觉格式化模型   
视觉格式化模型(`Visual Formatting Model`) 是`CSS`规范中定义的一套**算法和规则**，它决定了浏览器引擎如何将**`HTML`文档树(`DOM Tree`)** 中的每个元素，转换、计算并最终渲染为**屏幕上可见的图形**。

可以把它想象成浏览器的"布局引擎"。  
当浏览器加载一个页面时，它会做两件主要的事：  
1.解析内容：将`HTML`代码转换成`DOM`树，将`CSS`代码转换成`CSSOM`树。  
2.渲染：将`DOM`和`CSSOM`结合，通过**视觉格式化模型**这套规则，计算出每个元素在视口(`viewport`)中的确切大小、位置，并最终绘制到屏幕上。  

这个过程就是"渲染(`Rendering`)"或"布局(`layout`)",在老版本`IE`中也被称为"重排(`Reflow`)"。   

### 它具体是如何工作的？（核心规则）  
视觉格式化模型通过以下几套关键规则来工作：  
1.盒模型（`Box Model`）  
这是最基础的一环。模型规定**每一个元素都会生成一个或多个矩形盒**。这个盒子由内到外包括：  
+ `content`（内容）
+ `padding`(内边距)
+ `border`(边框)
+ `margin`(外边距)   

`CSS`的`box-sizing`属性可以改变计算盒子尺寸的方式（是`content-box`还是`border-box`）。  

2.定位方案（`Positioning Schemes`）  
模型定义了三种基本的布局定位方案，决定了盒子之间的关系：  
+ **常规流（`Normal Flow`）**：默认方案。包括：  
    + 块格式化上下文（`BFC`）:块级元素（如 `<div>、<p>`）会垂直排列，独占一行。   
    + 行内格式化上下文（`IFC`）:行内元素（如`<span>、<a>`）会水平排列，直到一行放不下再换行。  
    + **浮动(`Floats`)**：元素会脱离文档流，向左会向右浮动，其他内容会围绕在它周围。 
    + 绝对定位（`Absolute Positioning`）:元素完全脱离常规流，其位置相对于最近的已定位祖先元素或视口本身确定，不再影响其他元素的布局。  

3.层叠上下文（`Stacking Contexts`）  
它决定了元素发生重叠时，谁在上，谁在下的层级顺序（z轴）。规则由`z-index`、`opacity`、`transForm`等属性控制。   

### 它起到什么作用（为什么重要？）  
视觉格式化模型的作用是根本性的，主要体现在以下几点：  
1.实现精确的页面布局
它是所有`CSS`布局技术的**理论基础**。无论多古老的`float`布局，还是现代的`Flexbox`和`Grid`布局，都是在视觉格式化模型定义的这套规则之上构建的**具体实现工具。不理解模型，等同于死记硬背`CSS`属性**，遇到布局问题会无从下手。
2.解析和预测浏览器行为  
为什么`margin`会合并？为什么`float`需要清除？为什么`absolute`定位的元素不占空间？为什么`z-index`有时会失效？  
所有这些看似"怪异"的浏览器行为，其根源都在于**视觉格式化模型的规则**。理解了模型，你就能解释并预测这些行为，而不是觉得`CSS`"玄学"和"不可控"。 
3.解决布局中的疑难杂症  
当页面出现布局之外的问题时（例如：高度坍塌、外边距重叠、元素错位等），深厚的模型知识能帮助你快速定位问题的根源（是BFC问题？还是层叠上下文问题？），并选择最优雅的CSS方案（例如创建BFC、清除浮动）来解决它，而不是盲目地胡乱调试。
4.理解现代布局技术的基石
`Flexbox`和`Grid`是更高级、更强大的**布局模型**，但它们依然是视觉格式化模型这个大框架下的一部分。它们各自创建了自己独特的**格式化上下文**（`FFC`和`GFC`）,但依然遵循着盒模型、脱离文档流、层叠等基本规则。学好基础模型，能让你更快、更深刻地掌握这些现代布局技术。  

### 总结
|方面|解释|
|-|-|
|是什么|一套用来计算和渲染页面布局的底层规则和算法|
|核心规则|盒模型、定位方案（常规流、浮动、绝对定位）、**层叠上下文**|
|起到作用|1.实现布局的基础<br/> 2.解释浏览器行为<br/> 3.解决布局`bug`<br/> 4.学习应用现代布局(`Flex/Grid`)的基石|   

> **视觉格式模型就是`CSS`布局的"宪法"**，而`display`、`position`、`float`等`CSS`属性则是根据这部"宪法"制定的具体"法律"。理解了"宪法"，你才能真正读懂并灵活运用所有"法律"。


